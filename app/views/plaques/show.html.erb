<% content_for :page_title, @plaque %>
<% content_for :title do %>
  <%= linked_inscription @plaque %>
<% end %>
<% content_for :page_subhead do %>
  <span id="facebook_like_button"><iframe src="http://www.facebook.com/plugins/like.php?href=<%= plaque_path(@plaque, :only_path => false) %>&amp;layout=button_count&amp;show_faces=false&amp;width=90&amp;action=like&amp;font&amp;colorscheme=light&amp;height=35" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:75px; height:20px; text-align:right;" allowTransparency="true"></iframe></span>
  <% if @plaque.foreign? %>
    <div class="row">
      <% if @plaque.inscription_in_english %>
        <h7><%= t '.english_translation' %>: "<%= @plaque.inscription_in_english %>"</h7>
      <% else %>
        <div class="goog-trans-control"></div>
        <h6 class="goog-trans-section" lang=""><%= @plaque.inscription %></h6>
        <script>
          function googleSectionalElementInit() {
            new google.translate.SectionalElement({
              sectionalNodeClassName: 'goog-trans-section',
              controlNodeClassName: 'goog-trans-control',
              background: '#f4fa58'
            }, 'google_sectional_element');
          }
        </script>
        <script src="http://translate.google.com/translate_a/element.js?cb=googleSectionalElementInit&ug=section&hl=en"></script>
      <% end %>
    </div>
  <% end %>
<% end %>

<%= render 'plaques/edit_bar', :plaque => @plaque %>

<script>
  function copyTextToClipboard(text) {
    var textArea = document.createElement("textarea");
    textArea.style.position = 'fixed';
    textArea.style.top = 0;
    textArea.style.left = 0;
    textArea.style.width = '2em';
    textArea.style.height = '2em';
    textArea.style.padding = 0;
    textArea.style.border = 'none';
    textArea.style.outline = 'none';
    textArea.style.boxShadow = 'none';
    textArea.style.background = 'transparent';
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
      console.log('Copying text command was ' + msg);
    } catch (err) {
      console.log('Oops, unable to copy');
    }
    document.body.removeChild(textArea);
  }

  var copyFlickrTagBtn = document.querySelector('#copy-flickr-tag');
  copyFlickrTagBtn.addEventListener('click', function(event) {
    copyTextToClipboard('<%= @plaque.machine_tag %>');
  });

  var copyWikimediaTagBtn = document.querySelector('#copy-wikimedia-tag');
  copyWikimediaTagBtn.addEventListener('click', function(event) {
    copyTextToClipboard('<%= @plaque.wikimedia_tag %>');
  });
</script>

<div class="row">
  <div class="col-xs-12 col-md-8">
    <div class="container main-photo">
      <div class="col-xs-12">
        <%= render @plaque.main_photo if @plaque.main_photo %>
      </div>
    </div>
    <div class="card-columns">
      <%= link_to plaque_photos_path(@plaque) do %>
        <div class="card">
          <%= image_tag("NoPhotoSqr.png", :width => '100%', :class => 'img-rounded card-img-top') %>
          <p class="card-text"><%= t '.how_to_add_yours' %></p>
        </div>
      <% end %>
      <%= render @plaque.other_photos %>
    </div>
  </div>

  <div class="col-md-4">
    <%= content_tag(:p, t('.does_not_exist'), :class => 'bg-danger' ) unless @plaque.is_current %>
    <%= content_tag(:p, t('.not_erected'), :class => 'bg-warning' ) unless @plaque.erected? %>
    <% if @plaque.is_current && @plaque.geolocated? %>
      <div id="plaque-map" data-latitude="<%= @plaque.latitude %>" data-longitude="<%= @plaque.longitude %>" class="mini" data-zoom="17" data-view="one"></div>
      <%= content_tag(:div, t('.approximate_position'), :class => 'bg-danger' ) unless @plaque.is_accurate_geolocation %>
    <% end %>
    <p><%= @plaque.address %>, <%= link_to(@plaque.area.name, @plaque.area)  if @plaque.area %>
      <% if @plaque.roughly_geolocated? %>
       <br/>[<%= link_to "geolocate this address", edit_plaque_geolocation_path(@plaque), {:class => :edit, :title => "Geolocate"} %>]
     <% end %>
    </p>
    <p><% if @plaque.erected? %>Erected<% else %>To be erected<% end %> <%= erected_information @plaque %><% if @plaque.series %> as <% if @plaque.series_ref? %>#<%= content_tag(:span, @plaque.series_ref )%><% else %>part<% end %> of the <%= link_to @plaque.series.name, @plaque.series %> series<% end %></p>
    <p>Colour:
      <% if @plaque.colour %>
        <%= @plaque.colour.name %>
      <% else %>
        <% @colours = Colour.all %>
        <%= form_for @plaque do |f| %>
          <%= f.label :colour_id, "This plaque is" %>
          <%= f.collection_select :colour_id, @colours, :id, :name, {:include_blank => true} %>
          <%= f.submit "Save", :class => :button %>
        <% end %>
      <% end %>
    </p>
    <p>Wikimedia: <i><%= @plaque.wikimedia_tag %></i> <%= button_tag icon("clipboard"), id: 'copy-wikimedia-tag', type: 'button', :class => :button %></p>
    <p>Flickr: <i><%= @plaque.machine_tag %></i> <%= button_tag icon("clipboard"), id: 'copy-flickr-tag', type: 'button', :class => :button %></p>
    <h7><%= pluralize_word(@plaque.people.size, 'Subject') %></h7>
    <% if @plaque.people.size == 0 %>
      <p>None identified yet</p>
    <% else %>
      <style media="screen" type="text/css">
        @media (min-width: 34em) {
            .subjects .card-columns {
                -webkit-column-count: 2;
                -moz-column-count: 2;
                column-count: 2;
            }
        }
        @media (min-width: 48em) {
            .subjects .card-columns {
                -webkit-column-count: 2;
                -moz-column-count: 2;
                column-count: 2;
            }
        }
        @media (min-width: 62em) {
            .subjects .card-columns {
                -webkit-column-count: 2;
                -moz-column-count: 2;
                column-count: 2;
            }
        }
        @media (min-width: 75em) {
            .subjects .card-columns {
                -webkit-column-count: 2;
                -moz-column-count: 2;
                column-count: 2;
            }
        }
      </style>
      <div class="subjects">
        <div class="card-columns">
          <%= render @plaque.people %>
        </div>
      </div>
    <% end %>
</div>

<% unless @plaque.description.blank? %>
  <div class="row">
    <%= markdown(@plaque.description) %>
  </div>
<% end %>

<% unless @plaque.see_also.empty? %>
  <h7>See also...</h7>
  <div class="card-columns">
    <%= render partial: 'plaques/tile', collection: @plaque.see_also, as: :plaque %>
  </div>
<% end %>

<div<%= ' class=\"' + @plaque.colour.name + 'plaque\"' if @plaque.colour %> about="#this" typeof="op:Plaque"></div>
