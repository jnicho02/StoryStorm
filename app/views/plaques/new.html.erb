<% content_for(:page_title) {t('.page_title')} %>
<% content_for(:title) {t('.page_heading')} %>
<% content_for(:page_subhead) {t('.thanks')} %>

<script>
  $(function() {
    $('#plaque_other_colour_id').prop('disabled', 'disabled');
    $('input[name="plaque[colour_id]"]').change(function() {
        var val = $('input[name="plaque[colour_id]"]:radio:checked').val();
        if (val == "other") {
          $('#plaque_other_colour_id').prop('disabled', false);
        } else {
          $('#plaque_other_colour_id').prop('disabled', 'disabled');
        }
    });
  });

  $(function() {
    $( "#area" ).autocomplete({
      autofocus: true,
      source: function(request, response) {
        $.ajax({
          url: "/places/autocomplete",
          dataType: "json",
          data: {
            country_id: $('#plaque_country').val(),
            starts_with: request.term,
            limit: 10
          },
          success: function(data) {
            response($.map(data, function(item) {
              return {
                label: item.name,
                id: item.id,
                country_id: item.country_id
              }
            }));
          }
        });
      },
      select: function(event, ui) {
        $('#area_id').val(ui.item.id);
        $('#plaque_country').val(ui.item.country_id);
      }
    });
  });

  $(function() {
    $( "#organisation_name" ).autocomplete({
      autofocus: true,
      source: function(request, response) {
        $.ajax({
          url: "/organisations/autocomplete",
          dataType: "json",
          data: {
            contains: request.term,
            limit: 10
          },
          success: function(data) {
            response($.map(data, function(item) {
              return {
                label: item.name,
                id: item.id
              }
            }));
          }
        });
      },
      select: function(event, ui) {
        $('#plaque_organisation_id').val(ui.item.id);
      }
    });
  });
</script>

<style>
  .ui-autocomplete {
    list-style-type: none;
    width: 300px;
  }

  .ui-autocomplete .ui-menu-item {
    background: rgba(255,255,255,.95);
    border-bottom: dotted 1px #CCC;
  }

  html.no-rgba .ui-autocomplete .ui-menu-item {background: #FFF;}

  .ui-autocomplete .ui-menu-item a {
    display: block;
    font-size: 14px;
    color: #333;
    padding: 8px;
  }

  .ui-autocomplete .ui-menu-item a.ui-state-hover {
    color: #FFF;
    cursor: pointer;
  }

  .ui-autocomplete .ui-menu-item a#ui-active-menuitem {
    background: #4F7CBF;
    text-shadow: 1px 1px #333;
  }
</style>

<div class="row">
  <p class="col-xs-12 alert alert-warning"><%= t '.you_agree_to_open_licence' %></p>
</div>

<% if params[:checked] && params[:checked] == "true" %>
  <% if @plaque.errors.size > 0 %>
    <div class="error_alert"><%= t '.error' %></div>
  <% end %>

  <%= form_for @plaque do |f| %>
    <fieldset class="form-group row">
      <%= f.label :inscription, t('.inscription_heading'), :class => 'form-control-label' %>
      <%= f.text_area :inscription, {:value => params[:phrase], :placeholder => "Joe Bloggs lived here", :autofocus => 'true', :rows => "6", :cols => "50", :class => 'form-control'} %>
      <%= t('.inscription_advice') %>
    </fieldset>
    <fieldset class="form-group row">
      <%= f.label :inscription_is_stub, t('.inscription_partial'), :class => 'form-control-label col-sm-2' %>
      <div class="col-sm-10">
        <%= f.check_box :inscription_is_stub, :class => 'form-control' %>
      </div>
    </fieldset>
    <fieldset class="form-group row">
      <%= f.label :language_id, t('.language_heading'), :class => 'form-control-label col-sm-2' %>
      <div class="col-sm-10">
        <%= f.collection_select :language_id, @languages, :id, :name, :class => 'form-control' %>
      </div>
    </fieldset>
    <fieldset class="form-group row">
      <%= f.label :country, :class => 'form-control-label col-sm-2' %>
      <div class="col-sm-10">
        <%= f.collection_select :country, @countries, :id, :name, :include_blank => true, :selected => 1, :class => 'form-control' %>
      </div>
    </fieldset>
    <fieldset class="form-group row">
      <%= f.label :area, 'City/Town (just the town name please, no area or post code)', :class => 'form-control-label col-sm-2' %>
      <div class="col-sm-10">
        <%= text_field_tag :area, "", :placeholder => "London", :class => 'form-control' %>
        <%= hidden_field_tag :area_id %>
      </div>
    </fieldset>
    <div class="form-group row">
      <%= f.label :address, "Street and number", :class => 'form-control-label col-sm-2' %>
      <div class="col-sm-10">
        <%= f.text_field :address, {:placeholder => "221B Baker Street", :class => 'form-control'} %>
      </div>
    </div>
    <%= f.fields_for :organisation do |g| %>
      <div class="form-group row">
        <%= f.label :organisation_name, "Who put the plaque up?", :class => 'form-control-label col-sm-2' %>
        <div class="col-sm-10">
          <%= text_field_tag :organisation_name, "", {:placeholder => "English Heritage", :class => 'form-control'} %>
          <%= hidden_field_tag(:organisation_id) %>
        </div>
      </div>
      <div class="form-group row">
        <p class="col-sm-2">and when?</p>
        <div class="col-sm-10">
          <%= f.label :erected_at_1i, "Year" %>
          <%= f.label :erected_at_3i, "Day" %>
          <%= f.label :erected_at, "Month" %>
          <br/>
          <%= f.date_select :erected_at, :include_blank => true, :start_year => Time.now.year, :end_year => 1800, :field_name => :plaque_erected_at_year, :order => [:year, :day, :month], :class => 'form-control' %>
        </div>
      </div>
    <% end %>
    <div class="form-group row">
      <label class=",form-control-label col-sm-2"><%= t '.what_colour' %></label>
      <div class="col-sm-10">
        <% @common_colours.each do |colour| %>
          <div class="row radio">
            <%= f.radio_button :colour_id, colour.id %>
            <%= f.label "colour_id_" + colour.id.to_s, colour.name, :class => colour.name.downcase %>
          </div>
        <% end %>
        <div class="row radio other">
          <%= f.radio_button :colour_id, "other" %>
          <%= f.label :colour_id_other, "other:" %>
          <%= f.collection_select :other_colour_id, @other_colours, :id, :name, :include_blank => true %>
        </div>
        <div class="row radio unknown">
          <%= f.radio_button :colour_id, "nil", :checked => true %>
          <%= f.label :colour_id_nil, "unknown" %>
        </div>
      </div>
    </div>
    <%= f.submit t('buttons.save'), :class => 'btn btn-primary' %>
  <% end %>
<% else %>
  <div class="row">
    <p><%= t '.lets_check' %></p>
  </div>
  <div class="row">
    <%= render :partial => "search/search_form", :locals => { :phrase => @phrase } %>
  </div>
<% end %>
