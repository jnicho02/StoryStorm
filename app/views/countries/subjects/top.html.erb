<% content_for(:page_title) {t '.page_title', country: @country.name} %>
<% content_for(:admin_menu) {navbar_link_to t('buttons.add'), new_person_path} %>

<style>
  .list-group {
  	list-style: decimal inside;
  }

  .list-group-item {
  	display: list-item;
  }
</style>

<div class="jumbotron">
  <h1>
    <span class="flag-icon flag-icon-<%= @country.alpha2 %>"></span>
    <%= link_to(@country.name, @country) %>
    <%= t '.page_heading' %>
  </h1>
  <p>
    <%= @country.plaques.connected.count %> out of <%= @country.plaques.count %>
    (<%= ((@country.plaques.connected.count.to_f / @country.plaques.count.to_f) * 100).to_i %>%)
    plaques in <%= @country.name %> have been curated.
  </p>
</div>

<h2>Diversity</h2>
<div class="row">
  <canvas id="cvs" width="800" height="400">
    <ol class="list-group">
      <% @gender_total = @gender.inject(0){|sum, g| sum + g.plaques_count } %>
      <% @gender.each do |g| %>
        <li class="list-group-item">
          <%= g.gender %>
          <span class="badge badge-primary">(<%= (100 * g.plaques_count / @gender_total.to_f).to_i %>%)</span>
          <%= g.plaques_count %> now, estimate <%= (g.plaques_count * (1 / (@country.plaques.connected.count.to_f / @country.plaques.count.to_f))).to_i %>
        </li>
      <% end %>
    </ol>
  </canvas>
</div>

<script>
  window.onload = function ()
  {
    var pie = new RGraph.Pie({
      id: 'cvs',
      data: [<% @gender.each do |g| %><%= g.plaques_count %>,<% end %>],
      options: {
          radius: 150,
          colors: [
              'rgb(51,102,204)',
              'rgb(220,57,18)',
              'rgb(255,153,0)',
              'rgb(16,150,24)',
              'rgb(153,0,153)',
              'rgb(0,153,198)',
              'rgb(221,68,119)'
          ],
          linewidth: 2,
          shadow: false,
          labels: [<% @gender.each do |g| %>"<%= g.gender %> <%= g.plaques_count %> (<%= (100 * g.plaques_count / @gender_total.to_f).to_i %>%)",<% end %>],
          labelsSticksList: true,
          textFont: 'Arial',
          textSize: 16,
          textAccessible: true
      }
    }).grow();
  }
</script>

<h2>The top 50</h2>
<div class="row">
  <ol class="list-group">
  <% @top.each do |t| %>
    <li class="list-group-item"><%= link_to t.name, person_url(t.id) %> <span class="badge badge-primary"><%= t.plaques_count %></span></li>
  <% end %>
  </ol>
</div>
