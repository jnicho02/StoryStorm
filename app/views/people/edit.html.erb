<% content_for(:page_title) {t '.page_title', :person => @person.full_name} %>
<% content_for(:title) do %>
  <%= t '.page_heading' %> <%= link_to @person.full_name, @person %>
<% end %>

<h2>Depiction</h2>
<div class="row">
  <div class="col-xs-2">
    <img src="http://upload.wikimedia.org/wikipedia/commons/7/79/Wiki-commons.png"/>
  </div>
  <div class="col-xs-7">
    <p>We use images from Wikimedia Commons to depict subjects on Open Plaques as they are
    open licenced and free to use.</p>
    <p>
      Find a depiction image on
      <%= link_to(icon('external-link') +  'Wikipedia', @person.wikipedia_url, :target => '_blank') %>
      or
      <%= link_to(icon('external-link') +  'Wikimedia Commons', 'https://commons.wikimedia.org/w/index.php?title=Special:Search&limit=20&offset=40&profile=default&search=' + @person.name, :target => '_blank') %>
    </p>
    <p>
      <% @photo = Photo.new %>
      <%= form_for @photo do |f| %>
        <%= f.label(:url, "The Wikimedia photo page url is") %> <%= f.text_field :url %>
        <%= f.hidden_field :person_id, :value => @person.id %>
        <%= f.hidden_field :of_a_plaque, :value => false %>
        <%= submit_tag(t('buttons.save'), :class=> 'btn btn-primary') %>
      <% end %>
    </p>
  </div>
  <% if @person.main_photo %>
    <div class="col-xs-3">
      <%= render @person.main_photo %>
    </div>
  <% end %>
</div>

<%= form_for @person do |f| %>
  <fieldset class="form-group row">
    <%= f.label :name, @person.possessive + " name " + @person.existence_word %>
    <%= f.text_field :name %>
    <%= t '.display_name' %> "<%= @person.full_name %>"
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :aka %>
    <%= f.text_field :aka %>
  </fieldset>
  <fieldset class="form-group row">
    <%= @person.possessive %> surname <%= @person.existence_word %> "<%= @person.surname %>" which <%= f.label :surname_starts_with, "starts with" %> <%= f.text_field :surname_starts_with, :maxlength => 1 %>
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :gender %>
    <%= f.text_field :gender, :maxlength => 1 %>
  </fieldset>
  <fieldset class="form-group row">
    <%= @person.personal_pronoun %> was <%= f.label :born_on, @person.creation_word %> <%= f.text_field :born_on, {:maxlength => "10"} %> and <%= f.label :died_on, @person.destruction_word %> <%= f.text_field :died_on, {:maxlength => "10"} %>
    <%= "Died aged" if (@person.person? || @person.thing? || @person.animal?) && @person.dead? %><%= "Closed aged" if @person.place? && @person.dead? %><%= "Aged" if @person.alive? && @person.age%> <%= @person.age.to_s if @person.age%>
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :introduction %>
    <%= f.text_area :introduction, :class => 'form-control', :rows => 6 %>
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :wikipedia_url %>
    <%= f.text_field :wikipedia_url %>
    <%= t '.wikipedia_comment' %>
  </fieldset>
  <%= content_tag("p", "Read more about ".html_safe + link_to(@person.name, @person.default_wikipedia_url, :target => '_blank') + " on Wikipedia.".html_safe) unless @person.default_wikipedia_url.blank? %>
  <fieldset class="form-group row">
    <%= f.label :dbpedia_uri %>
    <%= f.text_field :dbpedia_uri %>
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :find_a_grave_id %>
    <%= f.text_field :find_a_grave_id %>
    <%= @person.find_a_grave_url unless @person.find_a_grave_id.blank? %>
  </fieldset>
  <fieldset class="form-group row">
    <%= f.label :ancestry_id %>
    <%= f.text_field :ancestry_id %>
    <%= @person.ancestry_url unless @person.ancestry_id.blank? %>
  </fieldset>
  <%= f.submit t('buttons.update'), :class => 'btn btn-primary' %>
<% end %>

<% if !@person.main_photo %>
  <div class="row">
    <div class="col-xs-2">

    </div>
    <div class="col-xs-10">
    </div>
  </div>
<% end %>

<% @person.personal_roles.each do |personal_role| %>
  <div class="row">
    <span class="col-sm-8">
      <%= @person.personal_pronoun %> <%= @person.existence_word %> a <%= dated_role(personal_role).html_safe %>
      <%= t('.conferring_the_letters') + ' ' + personal_role.role.abbreviation if personal_role.role.used_as_a_suffix? %><%= t('.conferring_the_title') + ' ' + personal_role.role.abbreviation if personal_role.role.used_as_a_prefix? %>
      <%= link_to t('buttons.edit'), edit_personal_role_path(personal_role), :class => 'btn btn-primary' %>
    </span>
    <span class="col-sm-4">
      <%= button_to t('buttons.delete'), personal_role, :method => :delete, :class => 'btn btn-danger' %>
    </span>
  </div>
<% end %>

<div class="row">
  <p><%= t '.features_on' %></p>
</div>
<div class="card-columns">
  <%= render @person.plaques.uniq %>
</div>
<div class="row">
  <p><%= t '.from_which_we_can_establish' %></p>
</div>

<div class="row">
  <%= form_for @personal_role do |f| %>
    <%= @person.name %> <%= @person.existence_word %> a <%= f.collection_select :role, @roles, :id, :full_name %> from <%= f.text_field :started_at %> to <%= f.text_field :ended_at %>
    <%= f.hidden_field :person_id, :value => @person.id %>
    <%= f.submit t('buttons.add'), :class => 'btn btn-primary' %>
  <% end %>
  <span class="col-sm-12">
    <%= link_to(t('.add_a_role'), new_role_path) %>
  </span>
</div>
