<% content_for :page_title, "Historical plaques about " + @person.name %>

<div class="panel">
  <%= content_tag(:section, link_to("Edit this "+@person.type, edit_person_path(@person), {:class => :edit, :title => "Edit this "+@person.type}), :class => :admin_panel) if current_user && current_user.is_admin? %>

  <div class="vcard person" typeof="<%= if (@person.person?) then "foaf:Person" else "foaf:Agent" end %> vcard:VCard" about="#person">

    <%= content_tag(:p, thumbnail_img(@person)) if @person.main_photo %>
    <h1><%= dated_person(@person, {:links => :none}) %> <%= roles_list(@person) %></h1>

    <% if @person.parents.size > 0 %>
      <p><%= 'parent'.pluralize @person.parents.size %>:<%= render @person.parents %></p>
    <% end %>

    <% if @person.spousal_relationships.size > 0 %>
      <p>
        <% @person.spousal_relationships.each_with_index do |relationship, index| %>
          <%= relationship.role.name %> of <%= dated_person relationship.related_person %>
          <% if index == @person.spousal_relationships.size - 2 %>and<% elsif index != @person.spousal_relationships.size - 1 %>,<% end %>
        <% end %>
      </p>
    <% end %>

    <% if @person.children.size > 0 %>
      <p><%= 'child'.pluralize @person.children.size %>:<%= render @person.children %></p>
    <% end %>

    <% if @person.siblings.size > 0 %>
      <p><%= 'sibling'.pluralize @person.siblings.size %>:<%= render @person.siblings %></p>
    <% end %>

    <% if @person.non_family_relationships.size > 0 %>
      <p>
        <% @person.non_family_relationships.each_with_index do |relationship, index| %>
          <%= relationship.role.name %> of <%= dated_person relationship.related_person %><% if index == @person.non_family_relationships.size - 2 %> and<% elsif index != @person.non_family_relationships.size - 1 %>,<% end %>
        <% end %>
      </p>
    <% end %>

    <p><%= "Died aged" if (@person.person? || @person.thing? || @person.animal?) && @person.dead? %><%= "Closed aged" if @person.place? && @person.dead? %><%= "Aged" if @person.alive? && @person.age%> <%= "c." + @person.age.to_s if @person.age%></p>

    <%= simple_format(@person.introduction) if @person.introduction %>

    <%#= content_tag("p", "Read more on ".html_safe + link_to("Wikipedia", @person.default_wikipedia_url, :target => '_blank')) unless @person.default_wikipedia_url.blank? %>

    <% if @person.uniq_plaques.size > 0 %>
      <h2>Commemorated on <%= @person.uniq_plaques.size %> <%= 'plaque'.pluralize @person.uniq_plaques.size %></h2>
    <% else %>
      <h2>Is not commemorated on any plaques in our database (yet)</h2>
    <% end %>
    <%= render @person.uniq_plaques %>
  </div>

  <p class="alternate_formats">Data about this <%= @person.type %> as <%= alternate_link_to "JSON", person_path(@person, :json), :json %></p>

</div>